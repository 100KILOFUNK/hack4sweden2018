<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>korrelationskollen</title>
</head>

<body>
    <h1>Välkommen till korrelationskollen!</h1>
    <p>Här kan du enkelt välja olika faktorer och se hur de korrelerar!</p>
    <p>Fokus är hur olika hälsoindikatorer korrelerar med andra faktorer. Tänk på att det som visas här är korrelation och inte
        ett samband mellan orsak och verkan. Faktorer kan till exempel samvariera p.g.a. att de har gemensamma orsaker och
        andra komplexa indirekta samband.</p>
    <canvas id="myChart" width="400" height="400"></canvas>
    <button onClick=getData></button>
</body>

</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script type="text/javascript">
    var ctx = document.getElementById("myChart");

    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    function getData() {
        $.ajax({
            url: '/data',
            method: 'GET',
            async: false,
            cache: false,
            timeout: 5000,
            dataType: "json",
            success: function (data) {
                console.log("success");

                addData(myChart, data.regions, data.sunHours);
            },
            complete: function (data) {
                console.log("completed");
            },
            error: function (jqXHR, textStatus, errorThrown) {

                alert('Error connecting to the Node.js server... ' + textStatus + " " + errorThrown);
            }
        });
    }

    function addData(chart, labels, data) {
        labels = labels.map(String);
        labels.forEach((l) => {
            chart.data.labels.push(l);
        })
        data.forEach((d) => {
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(d);
            });
        })
        chart.update();
    }

    getData();
</script>